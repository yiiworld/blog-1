<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Api | forecho]]></title>
  <link href="http://blog.forecho.com/categories/api/atom.xml" rel="self"/>
  <link href="http://blog.forecho.com/"/>
  <updated>2016-07-08T02:14:06+00:00</updated>
  <id>http://blog.forecho.com/</id>
  <author>
    <name><![CDATA[forecho]]></name>
    <email><![CDATA[caizhenghai@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Yii2 高级版新建一个 Api 应用]]></title>
    <link href="http://blog.forecho.com/yii2-create-api.html"/>
    <updated>2015-07-27T14:25:53+00:00</updated>
    <id>http://blog.forecho.com/yii2-create-api</id>
    <content type="html"><![CDATA[<p>先在项目的根目录下复制一份 backend 为 api：</p>

<p><code>sh
cp backend/ api -r
</code></p>

<p>拷贝 api 环境</p>

<p><code>sh
cp -a environments/dev/frontend environments/dev/api
cp -a environments/prod/frontend environments/prod/api
</code></p>

<p>修改 environments/index.php 文件之后的代码（主要是添加了一些 api 相关的代码）：</p>

<p><code>php
return [
    'Development' =&gt; [
        'path' =&gt; 'dev',
        'setWritable' =&gt; [
            'backend/runtime',
            'backend/web/assets',
            'frontend/runtime',
            'frontend/web/assets',
            'api/runtime',
            'api/web/assets',
        ],
        'setExecutable' =&gt; [
            'yii',
        ],
        'setCookieValidationKey' =&gt; [
            'backend/config/main-local.php',
            'frontend/config/main-local.php',
            'api/config/main-local.php',
        ],
    ],
    'Production' =&gt; [
        'path' =&gt; 'prod',
        'setWritable' =&gt; [
            'backend/runtime',
            'backend/web/assets',
            'frontend/runtime',
            'frontend/web/assets',
            'api/runtime',
            'api/web/assets',
        ],
        'setExecutable' =&gt; [
            'yii',
        ],
        'setCookieValidationKey' =&gt; [
            'backend/config/main-local.php',
            'frontend/config/main-local.php',
            'api/config/main-local.php',
        ],
    ],
];
</code></p>

<!--more-->

<p>然后再执行初始化命令：</p>

<p><code>sh
php init
</code></p>

<p>然后记得去 common/config/bootstrap.php 最后一行添加如下代码：</p>

<p><code>php
Yii::setAlias('api', dirname(dirname(__DIR__)) . '/api');
</code></p>

<p>修改一下配置文件 api/config/main.php</p>

<p><code>php
return [
    'id' =&gt; 'app-api',
    // ...
    'controllerNamespace' =&gt; 'api\controllers',
]
</code></p>

<p>最后 api 里面的控制器等有命名空间的文件也要修改一下。</p>

<p><strong>参考资料</strong></p>

<ul>
  <li><a href="http://blog.phpor.me/%E5%B7%A5%E4%BD%9C/yii/2014/11/17/yii2-usage.html#create_new_app">在原有的Yii2框架上，新建一个api应用</a></li>
  <li><a href="http://www.digpage.com/video_1.html">第一讲：基础配置</a></li>
</ul>
]]></content>
  </entry>
  
</feed>
